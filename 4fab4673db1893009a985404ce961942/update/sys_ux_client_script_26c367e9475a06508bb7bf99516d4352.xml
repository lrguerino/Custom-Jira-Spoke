<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ux_client_script">
    <sys_ux_client_script action="INSERT_OR_UPDATE">
        <controller_preset/>
        <includes/>
        <macroponent display_value="Jira Task Information">beb68c2d47dac2508bb7bf99516d437e</macroponent>
        <name>Transform Jira Data</name>
        <preset/>
        <required_translations>[
    {
        
    }
]</required_translations>
        <script><![CDATA[/**
 * @param {params} params
 * @param {api} params.api
 * @param {any} params.event
 * @param {any} params.imports
 * @param {ApiHelpers} params.helpers
 */
async function handler({
    api,
    event,
    helpers,
    imports
}) {

    const jiraData = api.data.get_current_task.result;
    const jiraStackedData = [];

    if (Object.keys(jiraData).length === 0) {
        // Return empty array and jira data is empty
        return jiraStackedData;
    }

    const FIELD_COMPONENT_MAPPING = {
        "u_jira_ebonding_status": ["Integration Status", "highlighted-value"],
        "u_jira_project": ["Project", "string"],
        "u_jira_issue_type": ["Issue Type", "string"],
        "u_jira_status": ["Status", "string"],
        "u_jira_assignee": ["Assignee", "text-link"]
    };

    const createObj = async (labelKey, type, key) => {
        const label = await helpers.translate(labelKey);
        let value;
        if (type === "string") {
            value = jiraData[key].displayValue;
        } else if (type === "text-link") {
            value = {
                type: type,
                value: jiraData[key].value,
                label: jiraData[key].displayValue,
                href: "javascript:void(0)"
            };
        } else if (type === "highlighted-value") {
            let color = "orange";
            let icon = "unlink-fill";
            switch (jiraData[key].value) {
                case "ERROR":
                    color = "critical";
                    icon = "exclamation-triangle-outline";
                    break;
                case "E_BONDED":
                    color = "green";
                    icon = "link-fill";
                    break;
                case "IN_PROGRESS":
                    color = "yellow";
                    icon = "sync_fill";
                    break;
            }
            value = {
                type: type,
                value: jiraData[key].value,
                label: jiraData[key].displayValue,
                color: color,
                showIcon: true,
                icon: icon,
                variant: "tertiary"
            };
        }
        return { label, value };
    };

    const processData = async (key, labelKey, type) => {
        if (jiraData[key].displayValue && jiraData[key].value) {
            jiraStackedData.push(await createObj(labelKey, type, key));
        };
    };

    // Here we start the main processing of the page

    for (const key in jiraData) {
        if (FIELD_COMPONENT_MAPPING[key]) {
            if (jiraData[key].displayValue && jiraData[key].value) {
                const [labelKey, type] = FIELD_COMPONENT_MAPPING[key];
                await processData(key, labelKey, type);
            }
        }
    }

    // We have everything to bind the data to the state properties;
    
    api.setState("jiraHeaderID", jiraData.u_jira_id.value);
    api.setState("jiraHeaderKey", jiraData.u_jira_key.value);
    api.setState("jiraStackedData", jiraStackedData);
    api.setState("hideLoader", true);
}]]></script>
        <script_api_version>2.0.0</script_api_version>
        <sys_class_name>sys_ux_client_script</sys_class_name>
        <sys_created_by>lucas.guerino@crossfuze.com</sys_created_by>
        <sys_created_on>2024-05-21 09:36:37</sys_created_on>
        <sys_id>26c367e9475a06508bb7bf99516d4352</sys_id>
        <sys_mod_count>281</sys_mod_count>
        <sys_name>Transform Jira Data</sys_name>
        <sys_package display_value="Jira Spoke" source="sn_jira_spoke">4fab4673db1893009a985404ce961942</sys_package>
        <sys_policy/>
        <sys_scope display_value="Jira Spoke">4fab4673db1893009a985404ce961942</sys_scope>
        <sys_update_name>sys_ux_client_script_26c367e9475a06508bb7bf99516d4352</sys_update_name>
        <sys_updated_by>lucas.guerino@crossfuze.com</sys_updated_by>
        <sys_updated_on>2024-05-31 11:50:23</sys_updated_on>
        <target>macroponent</target>
        <type>default</type>
    </sys_ux_client_script>
    <sys_claim action="INSERT_OR_UPDATE">
        <claim_owner_scope display_value="Jira Spoke">4fab4673db1893009a985404ce961942</claim_owner_scope>
        <claim_timestamp>18fe8c263720000001</claim_timestamp>
        <metadata_update_name>sys_ux_client_script_26c367e9475a06508bb7bf99516d4352</metadata_update_name>
        <previous_claim_app_version>4.4.0</previous_claim_app_version>
        <previous_claim_name>Jira Spoke</previous_claim_name>
        <previous_claim_scope>4fab4673db1893009a985404ce961942</previous_claim_scope>
        <sys_created_by>lucas.guerino@crossfuze.com</sys_created_by>
        <sys_created_on>2024-06-05 14:16:44</sys_created_on>
        <sys_id>ffa8f5ae47eec6908bb7bf99516d43c9</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>lucas.guerino@crossfuze.com</sys_updated_by>
        <sys_updated_on>2024-06-05 14:16:44</sys_updated_on>
    </sys_claim>
</record_update>
